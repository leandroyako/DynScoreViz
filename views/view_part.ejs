<html lang="en">
<%- include("./partials/head.ejs") %>
<link rel="stylesheet" href="../css/view_part.css">

<body>

    <%- include("./partials/nav.ejs") %>
    <% staves = JSON.parse(data) %>

    <div class="wrapper">
        <object class="visible inactive" type='image/svg+xml' data="../svg/<%= route %>/<%= staves[staves.length -2].svg %>.cropped.svg"> Actual score
        </object>
        <object class="visible active" type='image/svg+xml' data="../svg/<%= route %>/<%= staves[staves.length -1].svg %>.cropped.svg"> Previous score
        </object>
        <p id="txt"></p>
    </div>

    <div class="details content">
        <div class="metronome">
            <p class="bpm" style="margin-bottom: 0px; padding-bottom: 0px;">120</p>
        </div>
    </div>

    <!-- <%- include("./partials/footer.ejs") %> -->


    <!-- <script src='../scripts/animate_staff.js'></script> -->

    <script src="../socket.io.js"></script>
    <script>
        var socket = io();
        var activeObject = document.querySelector(".wrapper .active");
        var inactiveObject = document.querySelector(".wrapper .inactive");
        var bpmDisplay = document.querySelector(".metronome .bpm");
        var metronomeBox = document.querySelector(".metronome");

        function update(data) {
            let oldObjectData = activeObject.data;
            inactiveObject.data = oldObjectData;
            activeObject.data = `../svg/${data.route}/${data.svg}.cropped.svg`;

            console.log(oldObjectData);
            console.log(inactiveObject);
            console.log(activeObject);
        };

        socket.on('beat', function(data) {
            metronomeBox.classList.add('blink');
            setTimeout(function() {
                metronomeBox.classList.remove('blink')
            }, 30);
        });

        socket.on('bpm', function(data) {
            bpmDisplay.innerHTML = data.bpm;
        });


        socket.on('update', function(data) {
            update(data)
        })
    </script>
</body>

</html>